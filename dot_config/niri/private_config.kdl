// Niri config - mirrors Hyprland setup

input {
    mod-key "Alt"

    keyboard {
        xkb {
            layout "us,ru"
            options "grp:alt_shift_toggle"
        }
    }

    mouse {
        accel-profile "adaptive"
        accel-speed -0.7
    }

    touchpad {
        tap
        natural-scroll
    }
}

// Monitor config
output "DP-1" {
    mode "3440x1440@144.000"
    scale 1
}

// Autostart
spawn-at-startup "dms" "run"
spawn-at-startup "xwayland-satellite"
spawn-at-startup "wl-paste" "--type" "text" "--watch" "cliphist" "store"
spawn-at-startup "wl-paste" "--type" "image" "--watch" "cliphist" "store"
spawn-at-startup "nm-applet"
spawn-at-startup "udiskie"
spawn-sh-at-startup "~/.config/hypr/scripts/gpu-fan-control.sh"
spawn-sh-at-startup "sleep 2 && sudo sing-box run -c ~/.config/sing-box/config.json >> ~/.local/share/singbox.log 2>&1 &"

// Environment
environment {
    XCURSOR_SIZE "24"
    XCURSOR_THEME "Adwaita"
    GTK_USE_PORTAL "1"
    GDK_BACKEND "wayland,x11"
    QT_QPA_PLATFORM "wayland;xcb"
    MOZ_ENABLE_WAYLAND "1"
    ELECTRON_OZONE_PLATFORM_HINT "auto"
    GTK_THEME "Adwaita:dark"
    GTK_ICON_THEME "Papirus-Dark"
    QT_QPA_PLATFORMTHEME "qt5ct"
    QT_STYLE_OVERRIDE "kvantum"
}

// Layout
layout {
    gaps 40

    center-focused-column "never"

    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    default-column-width { proportion 0.5; }

    focus-ring {
        off
    }

    border {
        off
    }
}

// Cursor
cursor {
    xcursor-theme "Adwaita"
    xcursor-size 24
}

// Hotkey overlay
hotkey-overlay {
    skip-at-startup
}

// Window rules - rounded corners for all windows
window-rule {
    geometry-corner-radius 12
    clip-to-geometry true
}

// Chrome/Chromium - убрать CSD для нормальных рамок
window-rule {
    match app-id=r#"^chrome"#
    match app-id=r#"^chromium"#
    match app-id=r#"^brave"#
    draw-border-with-background false
}

// Keybinds - same as Hyprland
binds {
    // Apps
    Alt+W { spawn "ghostty"; }
    Alt+Q { close-window; }
    Alt+M { quit; }
    Alt+E { spawn "nautilus"; }
    Alt+B { spawn "google-chrome-stable" "--enable-features=UseOzonePlatform" "--ozone-platform=wayland" "--gtk-version=4"; }
    Alt+Ctrl+B { spawn "brave" "--enable-features=UseOzonePlatform,WaylandWindowDecorations" "--ozone-platform=wayland"; }
    Alt+O { spawn "obs"; }
    Alt+Ctrl+T { spawn "missioncenter"; }

    // DMS
    Alt+Space { spawn "dms" "ipc" "call" "spotlight" "toggle"; }
    Alt+N { spawn "dms" "ipc" "call" "notifications" "toggle"; }
    Alt+V { spawn "dms" "ipc" "call" "clipboard" "toggle"; }
    Alt+X { spawn "dms" "ipc" "call" "powermenu" "toggle"; }
    Alt+Grave { spawn "dms" "ipc" "call" "overview" "toggle"; }
    Alt+Ctrl+A { spawn "dms" "ipc" "call" "dankdash" "wallpaper"; }

    // Alt+Tab window switching
    Alt+Tab { focus-column-right; }
    Alt+Shift+Tab { focus-column-left; }

    // Window management
    Alt+T { toggle-window-floating; }
    Alt+F { maximize-column; }
    Alt+Ctrl+W { spawn-sh "~/.config/niri/scripts/restart_niri.sh"; }

    // Focus - vim keys
    Alt+H { focus-column-left; }
    Alt+J { focus-window-down; }
    Alt+K { focus-window-up; }
    Alt+L { focus-column-right; }

    // Focus - arrows
    Alt+Left { focus-column-left; }
    Alt+Down { focus-window-down; }
    Alt+Up { focus-window-up; }
    Alt+Right { focus-column-right; }

    // Move windows - vim keys
    Alt+Shift+H { move-column-left; }
    Alt+Shift+J { move-window-down; }
    Alt+Shift+K { move-window-up; }
    Alt+Shift+L { move-column-right; }

    // Resize
    Alt+Ctrl+H { set-column-width "-5%"; }
    Alt+Ctrl+L { set-column-width "+5%"; }
    Alt+Ctrl+J { set-window-height "+5%"; }
    Alt+Ctrl+K { set-window-height "-5%"; }

    // Workspaces
    Alt+1 { focus-workspace 1; }
    Alt+2 { focus-workspace 2; }
    Alt+3 { focus-workspace 3; }
    Alt+4 { focus-workspace 4; }
    Alt+5 { focus-workspace 5; }
    Alt+6 { focus-workspace 6; }
    Alt+7 { focus-workspace 7; }
    Alt+8 { focus-workspace 8; }
    Alt+9 { focus-workspace 9; }

    // Move to workspace
    Alt+Ctrl+1 { move-column-to-workspace 1; }
    Alt+Ctrl+2 { move-column-to-workspace 2; }
    Alt+Ctrl+3 { move-column-to-workspace 3; }
    Alt+Ctrl+4 { move-column-to-workspace 4; }
    Alt+Ctrl+5 { move-column-to-workspace 5; }
    Alt+Ctrl+6 { move-column-to-workspace 6; }
    Alt+Ctrl+7 { move-column-to-workspace 7; }
    Alt+Ctrl+8 { move-column-to-workspace 8; }
    Alt+Ctrl+9 { move-column-to-workspace 9; }

    // Alt + scroll = horizontal (switch columns/windows)
    Alt+WheelScrollDown { focus-column-left; }
    Alt+WheelScrollUp { focus-column-right; }
    Alt+WheelScrollLeft { focus-column-left; }
    Alt+WheelScrollRight { focus-column-right; }

    // Super + scroll = vertical (switch workspaces)
    Super+WheelScrollDown { focus-workspace-down; }
    Super+WheelScrollUp { focus-workspace-up; }

    // Screenshot
    Print { screenshot; }
    Alt+Ctrl+S { screenshot; }

    // Scripts
    Alt+P { spawn-sh "~/.config/hypr/scripts/singbox-toggle.sh"; }
    // Alt+I { spawn-sh "~/.config/hypr/scripts/socks-toggle.sh"; }
}
